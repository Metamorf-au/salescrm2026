<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sales CRM — Patching &amp; Vulnerability Management Policy</title>
<style>
  @page { margin: 18mm 16mm; size: A4; }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; color: #1e293b; line-height: 1.6; padding: 40px; max-width: 920px; margin: 0 auto; }

  /* Cover */
  .cover { text-align: center; padding: 50px 0 36px; border-bottom: 3px solid #0ea5e9; margin-bottom: 36px; }
  .cover h1 { font-size: 32px; font-weight: 700; color: #0f172a; margin-bottom: 6px; }
  .cover .subtitle { font-size: 18px; color: #64748b; margin-bottom: 20px; }
  .cover .meta { font-size: 13px; color: #94a3b8; }
  .cover .meta span { margin: 0 10px; }

  /* Headings */
  h2 { font-size: 21px; font-weight: 700; color: #0f172a; margin: 32px 0 14px; padding-bottom: 7px; border-bottom: 2px solid #e2e8f0; }
  h3 { font-size: 16px; font-weight: 700; color: #334155; margin: 22px 0 10px; }
  h4 { font-size: 14px; font-weight: 600; color: #475569; margin: 14px 0 8px; }

  p { font-size: 14px; color: #475569; margin-bottom: 12px; }

  /* Lists */
  ul, ol { margin: 0 0 14px 20px; }
  ul li, ol li { font-size: 14px; color: #475569; margin-bottom: 5px; }
  ul li strong, ol li strong { color: #1e293b; }

  /* Tables */
  table { width: 100%; border-collapse: collapse; margin: 14px 0 20px; font-size: 13px; }
  th { background: #f1f5f9; color: #334155; font-weight: 600; text-align: left; padding: 9px 12px; border: 1px solid #e2e8f0; }
  td { padding: 9px 12px; border: 1px solid #e2e8f0; color: #475569; }
  tr:nth-child(even) td { background: #f8fafc; }

  /* Boxes */
  .box { border-radius: 8px; padding: 14px 18px; margin: 14px 0; }
  .box-blue { background: #f0f9ff; border: 1px solid #bae6fd; }
  .box-green { background: #f0fdf4; border: 1px solid #bbf7d0; }
  .box-amber { background: #fffbeb; border: 1px solid #fde68a; }
  .box-red { background: #fef2f2; border: 1px solid #fecaca; }
  .box-slate { background: #f8fafc; border: 1px solid #e2e8f0; }
  .box p { margin-bottom: 4px; }

  /* Badges */
  .badge { display: inline-block; font-size: 11px; font-weight: 600; padding: 3px 10px; border-radius: 20px; }
  .badge-green { background: #dcfce7; color: #15803d; }
  .badge-blue { background: #dbeafe; color: #1d4ed8; }
  .badge-amber { background: #fef3c7; color: #92400e; }
  .badge-red { background: #fee2e2; color: #991b1b; }
  .badge-slate { background: #f1f5f9; color: #475569; }

  /* Section cards */
  .section-card { border: 1px solid #e2e8f0; border-radius: 10px; padding: 20px 24px; margin: 18px 0; break-inside: avoid; }
  .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 14px; }
  .section-header h3 { margin: 0; }

  /* Code */
  code { font-family: "SF Mono", Menlo, Monaco, monospace; font-size: 12px; background: #f1f5f9; padding: 2px 6px; border-radius: 4px; color: #334155; }
  pre { background: #1e293b; color: #e2e8f0; padding: 16px 20px; border-radius: 8px; margin: 12px 0 16px; overflow-x: auto; font-size: 12px; line-height: 1.7; }
  pre code { background: none; padding: 0; color: inherit; }

  /* Flow diagram */
  .flow { display: flex; align-items: center; gap: 8px; flex-wrap: wrap; margin: 16px 0; }
  .flow-step { background: #f0f9ff; border: 1px solid #bae6fd; border-radius: 8px; padding: 10px 16px; font-size: 13px; font-weight: 500; color: #0369a1; text-align: center; min-width: 120px; }
  .flow-arrow { color: #94a3b8; font-size: 18px; }

  @media print {
    body { padding: 0; }
    .section-card { break-inside: avoid; }
  }
</style>
</head>
<body>

<!-- COVER -->
<div class="cover">
  <h1>Patching &amp; Vulnerability Management Policy</h1>
  <p class="subtitle">Precision CRM &mdash; SalesCRM 2026</p>
  <p class="meta">
    <span>Date: 10 February 2026</span> |
    <span>Classification: Internal</span> |
    <span>Version: 1.0</span> |
    <span>Review cycle: Quarterly</span>
  </p>
</div>

<!-- PURPOSE -->
<h2>1. Purpose &amp; Scope</h2>
<p>This policy defines the processes, tools, and responsibilities for identifying, assessing, and remediating security vulnerabilities in the Precision CRM platform. It covers:</p>
<ul>
  <li>npm dependencies (production and development)</li>
  <li>GitHub Actions CI/CD pipeline</li>
  <li>Supabase managed services (database, authentication, edge functions)</li>
  <li>Netlify hosting infrastructure</li>
</ul>

<div class="box box-blue">
  <p><strong>Principle:</strong> Vulnerabilities are treated as defects. Critical and high-severity issues are patched within defined SLAs. The process is automated wherever possible to reduce human error and response time.</p>
</div>

<!-- ROLES -->
<h2>2. Roles &amp; Responsibilities</h2>

<table>
  <tr><th style="width:25%">Role</th><th style="width:35%">Responsibility</th><th>Frequency</th></tr>
  <tr><td><strong>Developer</strong></td><td>Review Dependabot PRs, run <code>npm audit</code> before each release, apply patches</td><td>Weekly / per release</td></tr>
  <tr><td><strong>Team Lead</strong></td><td>Approve and merge dependency update PRs, escalate critical findings</td><td>Weekly</td></tr>
  <tr><td><strong>Compliance Manager</strong></td><td>Review audit reports, verify SLA adherence, maintain this policy</td><td>Monthly / quarterly review</td></tr>
  <tr><td><strong>Automated (CI/CD)</strong></td><td>Run <code>npm audit</code> on every push/PR, weekly scheduled scan, alert on failures</td><td>Continuous</td></tr>
</table>

<!-- AUTOMATED TOOLING -->
<h2>3. Automated Scanning &amp; Tooling</h2>

<div class="section-card">
  <div class="section-header">
    <h3>3.1 GitHub Dependabot</h3>
    <span class="badge badge-green">ACTIVE</span>
  </div>
  <p>Dependabot is configured to automatically scan for vulnerable and outdated dependencies.</p>
  <table>
    <tr><th>Setting</th><th>Value</th></tr>
    <tr><td>Scan frequency</td><td>Weekly (Monday 07:00 AEST)</td></tr>
    <tr><td>Ecosystems monitored</td><td>npm packages, GitHub Actions</td></tr>
    <tr><td>Auto-PR creation</td><td>Yes &mdash; grouped by production / dev dependencies</td></tr>
    <tr><td>PR limit</td><td>10 open PRs maximum</td></tr>
    <tr><td>Labels</td><td><code>dependencies</code>, <code>security</code></td></tr>
  </table>
  <p><strong>How it works:</strong> When a vulnerability is published in the GitHub Advisory Database, Dependabot automatically creates a pull request to update the affected package. Security updates are prioritised over version updates.</p>
  <p><strong>Configuration file:</strong> <code>.github/dependabot.yml</code></p>
</div>

<div class="section-card">
  <div class="section-header">
    <h3>3.2 GitHub Actions &mdash; Security Audit Workflow</h3>
    <span class="badge badge-green">ACTIVE</span>
  </div>
  <p>An automated CI pipeline runs vulnerability checks on multiple triggers:</p>
  <table>
    <tr><th>Trigger</th><th>When</th></tr>
    <tr><td>Push to <code>main</code></td><td>Every merge to production branch</td></tr>
    <tr><td>Pull request to <code>main</code></td><td>Every PR before merge</td></tr>
    <tr><td>Scheduled</td><td>Weekly (Monday 07:00 UTC)</td></tr>
    <tr><td>Manual</td><td>On-demand via GitHub Actions UI</td></tr>
  </table>
  <h4>Pipeline Jobs</h4>
  <table>
    <tr><th>Job</th><th>Purpose</th><th>Failure behaviour</th></tr>
    <tr><td><strong>npm Audit</strong></td><td>Scan production dependencies for known CVEs</td><td>Fails the pipeline on high/critical severity</td></tr>
    <tr><td><strong>Outdated Check</strong></td><td>Report packages behind latest version</td><td>Advisory only (does not block)</td></tr>
    <tr><td><strong>Build Verification</strong></td><td>Confirm the app builds successfully, report bundle size</td><td>Fails on build errors</td></tr>
  </table>
  <p><strong>Configuration file:</strong> <code>.github/workflows/security-audit.yml</code></p>
</div>

<div class="section-card">
  <div class="section-header">
    <h3>3.3 Manual Audit Commands</h3>
    <span class="badge badge-blue">AVAILABLE</span>
  </div>
  <p>Developers can run security checks locally at any time:</p>
  <pre><code># Scan production dependencies for vulnerabilities
npm run audit

# Auto-fix vulnerabilities where possible
npm run audit:fix

# Check which packages have newer versions available
npm run outdated</code></pre>
</div>

<!-- VULNERABILITY CLASSIFICATION -->
<h2>4. Vulnerability Classification &amp; SLAs</h2>

<p>Vulnerabilities are classified using the severity levels from the <a href="https://www.first.org/cvss/">Common Vulnerability Scoring System (CVSS)</a> as reported by npm and the GitHub Advisory Database.</p>

<table>
  <tr><th style="width:15%">Severity</th><th style="width:15%">CVSS Score</th><th style="width:25%">Response SLA</th><th>Action Required</th></tr>
  <tr>
    <td><span class="badge badge-red">Critical</span></td>
    <td>9.0 &ndash; 10.0</td>
    <td><strong>24 hours</strong></td>
    <td>Immediate patch. If no fix available, remove or replace the package. Notify compliance manager.</td>
  </tr>
  <tr>
    <td><span class="badge badge-amber">High</span></td>
    <td>7.0 &ndash; 8.9</td>
    <td><strong>72 hours</strong></td>
    <td>Patch within 3 business days. CI pipeline blocks merge until resolved.</td>
  </tr>
  <tr>
    <td><span class="badge badge-blue">Medium</span></td>
    <td>4.0 &ndash; 6.9</td>
    <td><strong>14 days</strong></td>
    <td>Patch within the next scheduled maintenance window or sprint.</td>
  </tr>
  <tr>
    <td><span class="badge badge-slate">Low</span></td>
    <td>0.1 &ndash; 3.9</td>
    <td><strong>30 days</strong></td>
    <td>Address during routine dependency updates. May be deferred with documented justification.</td>
  </tr>
</table>

<div class="box box-amber">
  <p><strong>Escalation:</strong> If a critical or high vulnerability cannot be resolved within the SLA, the developer must notify the team lead and compliance manager with a written justification and an estimated remediation date.</p>
</div>

<!-- PATCHING PROCESS -->
<h2>5. Patching Process</h2>

<div class="flow">
  <div class="flow-step">Vulnerability<br>Detected</div>
  <span class="flow-arrow">&rarr;</span>
  <div class="flow-step">Classify<br>Severity</div>
  <span class="flow-arrow">&rarr;</span>
  <div class="flow-step">Assess<br>Impact</div>
  <span class="flow-arrow">&rarr;</span>
  <div class="flow-step">Apply<br>Patch</div>
  <span class="flow-arrow">&rarr;</span>
  <div class="flow-step">Test &amp;<br>Build</div>
  <span class="flow-arrow">&rarr;</span>
  <div class="flow-step">Deploy to<br>Production</div>
  <span class="flow-arrow">&rarr;</span>
  <div class="flow-step">Log &amp;<br>Close</div>
</div>

<div class="section-card">
  <h3>Step-by-Step</h3>
  <ol>
    <li><strong>Detection:</strong> Vulnerability is identified via Dependabot alert, CI pipeline failure, weekly scan, or manual <code>npm audit</code>.</li>
    <li><strong>Classification:</strong> Severity is automatically determined by CVSS score. Developer confirms applicability (is the vulnerable code path actually used?).</li>
    <li><strong>Impact Assessment:</strong> Determine if the vulnerability is exploitable in the context of this application. Document findings.</li>
    <li><strong>Patching:</strong>
      <ul>
        <li><strong>Automated:</strong> Merge Dependabot PR if tests pass and the update is non-breaking.</li>
        <li><strong>Manual:</strong> Run <code>npm run audit:fix</code> or manually update <code>package.json</code> and test.</li>
        <li><strong>Breaking change:</strong> If the patch requires code changes, create a feature branch, apply changes, and test thoroughly.</li>
      </ul>
    </li>
    <li><strong>Testing:</strong> CI pipeline runs <code>npm audit</code> + build verification on the PR. Developer verifies the application functions correctly.</li>
    <li><strong>Deployment:</strong> Merge to <code>main</code>. Netlify automatically deploys the updated build.</li>
    <li><strong>Logging:</strong> The merged PR serves as the audit trail. For critical/high issues, add an entry to the vulnerability log (Section 9).</li>
  </ol>
</div>

<!-- MANAGED SERVICE PATCHING -->
<h2>6. Managed Service Patching</h2>

<p>The following infrastructure components are managed services where patching is handled by the service provider. Our responsibility is limited to monitoring announcements and ensuring we are on supported versions.</p>

<div class="section-card">
  <h3>6.1 Supabase (Database, Auth, Edge Functions)</h3>
  <table>
    <tr><th style="width:30%">Component</th><th>Patching Responsibility</th><th>Our Action</th></tr>
    <tr><td>PostgreSQL database</td><td>Supabase applies security patches</td><td>Monitor Supabase status page and release notes</td></tr>
    <tr><td>Authentication service</td><td>Supabase manages auth infrastructure</td><td>Keep <code>@supabase/supabase-js</code> SDK updated</td></tr>
    <tr><td>Edge Functions (Deno)</td><td>Supabase updates Deno runtime</td><td>Monitor for runtime deprecations</td></tr>
    <tr><td>RLS policies</td><td>Customer-managed</td><td>Review policies quarterly for correctness</td></tr>
  </table>
  <p><strong>Monitoring:</strong> Subscribe to <a href="https://status.supabase.com">status.supabase.com</a> and the Supabase GitHub releases for security advisories.</p>
</div>

<div class="section-card">
  <h3>6.2 Netlify (Hosting &amp; CDN)</h3>
  <table>
    <tr><th style="width:30%">Component</th><th>Patching Responsibility</th><th>Our Action</th></tr>
    <tr><td>TLS certificates</td><td>Netlify auto-renews via Let's Encrypt</td><td>No action required</td></tr>
    <tr><td>CDN infrastructure</td><td>Netlify manages edge servers</td><td>No action required</td></tr>
    <tr><td>Build environment</td><td>Netlify updates Node.js runtimes</td><td>Specify Node version if needed in <code>netlify.toml</code></td></tr>
  </table>
  <p><strong>Monitoring:</strong> Subscribe to <a href="https://www.netlifystatus.com">netlifystatus.com</a> for incident notifications.</p>
</div>

<div class="section-card">
  <h3>6.3 GitHub (Source Control &amp; CI/CD)</h3>
  <table>
    <tr><th style="width:30%">Component</th><th>Patching Responsibility</th><th>Our Action</th></tr>
    <tr><td>GitHub Actions runners</td><td>GitHub maintains runner images</td><td>Pin action versions; Dependabot monitors for updates</td></tr>
    <tr><td>Dependabot engine</td><td>GitHub maintains scanning</td><td>No action required</td></tr>
    <tr><td>Advisory database</td><td>GitHub curates CVE entries</td><td>Alerts are consumed automatically</td></tr>
  </table>
</div>

<!-- DEPENDENCY UPDATE SCHEDULE -->
<h2>7. Dependency Update Schedule</h2>

<table>
  <tr><th>Category</th><th>Update Type</th><th>Frequency</th><th>Process</th></tr>
  <tr><td><strong>Security patches</strong></td><td>Any severity</td><td>As detected (within SLA)</td><td>Dependabot PR &rarr; review &rarr; merge</td></tr>
  <tr><td><strong>Patch versions</strong> (x.x.<strong>Z</strong>)</td><td>Bug fixes</td><td>Weekly (grouped Dependabot PRs)</td><td>Review changelog &rarr; merge if tests pass</td></tr>
  <tr><td><strong>Minor versions</strong> (x.<strong>Y</strong>.z)</td><td>New features</td><td>Fortnightly</td><td>Review changelog &rarr; test in dev &rarr; merge</td></tr>
  <tr><td><strong>Major versions</strong> (<strong>X</strong>.y.z)</td><td>Breaking changes</td><td>Quarterly (or as needed)</td><td>Dedicated branch &rarr; full regression test &rarr; staged rollout</td></tr>
</table>

<div class="box box-slate">
  <p><strong>Lock file:</strong> Always commit <code>package-lock.json</code> to ensure reproducible builds. Use <code>npm ci</code> in CI/CD (not <code>npm install</code>) to install exact locked versions.</p>
</div>

<!-- QUARTERLY REVIEW -->
<h2>8. Quarterly Security Review</h2>

<p>Every quarter, the following review is conducted and documented:</p>

<div class="section-card">
  <h3>Quarterly Review Checklist</h3>
  <table>
    <tr><th style="width:5%">#</th><th>Item</th><th style="width:20%">Owner</th></tr>
    <tr><td>1</td><td>Run full <code>npm audit</code> and resolve all findings</td><td>Developer</td></tr>
    <tr><td>2</td><td>Review and merge all pending Dependabot PRs</td><td>Team Lead</td></tr>
    <tr><td>3</td><td>Verify all production dependencies are within one minor version of latest</td><td>Developer</td></tr>
    <tr><td>4</td><td>Review Supabase RLS policies for correctness and completeness</td><td>Developer</td></tr>
    <tr><td>5</td><td>Verify Edge Function authorisation checks are intact</td><td>Developer</td></tr>
    <tr><td>6</td><td>Review Supabase and Netlify status pages for past incidents</td><td>Team Lead</td></tr>
    <tr><td>7</td><td>Check that <code>.env</code> files and secrets are not committed to git</td><td>Developer</td></tr>
    <tr><td>8</td><td>Review and update this policy document if needed</td><td>Compliance Manager</td></tr>
    <tr><td>9</td><td>Log quarterly review completion in vulnerability log</td><td>Compliance Manager</td></tr>
  </table>
</div>

<!-- VULNERABILITY LOG -->
<h2>9. Vulnerability Log</h2>

<p>Maintain a running log of all critical and high vulnerabilities detected and resolved. This table serves as the audit trail for compliance reporting.</p>

<table>
  <tr>
    <th>Date</th>
    <th>Package / Component</th>
    <th>CVE / Advisory</th>
    <th>Severity</th>
    <th>Resolved Date</th>
    <th>Resolution</th>
  </tr>
  <tr>
    <td colspan="6" style="text-align:center; color:#94a3b8; font-style:italic; padding:20px;">No vulnerabilities recorded to date. System deployed 10 February 2026.</td>
  </tr>
</table>

<div class="box box-blue">
  <p><strong>Template row:</strong> <code>2026-02-10 | package-name | CVE-2026-XXXXX | High | 2026-02-12 | Updated to v2.1.0 via Dependabot PR #42</code></p>
</div>

<!-- INCIDENT RESPONSE -->
<h2>10. Incident Response</h2>

<div class="section-card">
  <h3>If a vulnerability is actively exploited</h3>
  <ol>
    <li><strong>Contain:</strong> If the vulnerability allows data access, immediately rotate the Supabase anon key and service role key via the Supabase dashboard.</li>
    <li><strong>Assess:</strong> Review the <code>activity_log</code> table and Supabase auth logs for suspicious activity.</li>
    <li><strong>Patch:</strong> Apply the fix immediately. If no fix exists, disable the affected functionality.</li>
    <li><strong>Communicate:</strong> Notify the compliance manager and affected users if data exposure is confirmed.</li>
    <li><strong>Document:</strong> Log the incident in the vulnerability log with full timeline and root cause.</li>
  </ol>
</div>

<div class="section-card">
  <h3>Key Rotation Procedures</h3>
  <table>
    <tr><th>Secret</th><th>Rotation Method</th><th>Impact</th></tr>
    <tr><td>Supabase anon key</td><td>Supabase Dashboard &rarr; Settings &rarr; API</td><td>Update <code>.env</code> and Netlify env vars; redeploy</td></tr>
    <tr><td>Supabase service role key</td><td>Supabase Dashboard &rarr; Settings &rarr; API</td><td>Update Edge Function secrets; redeploy functions</td></tr>
    <tr><td>User passwords</td><td>Admin panel &rarr; Reset Password</td><td>User receives reset email</td></tr>
  </table>
</div>

<!-- COMPLIANCE MAPPING -->
<h2>11. Compliance Framework Mapping</h2>

<p>This policy addresses the following common compliance requirements:</p>

<table>
  <tr><th style="width:25%">Framework</th><th style="width:25%">Control</th><th>How Addressed</th></tr>
  <tr><td>ISO 27001</td><td>A.12.6 — Technical vulnerability management</td><td>Automated scanning (Dependabot + CI), SLAs, quarterly review</td></tr>
  <tr><td>ISO 27001</td><td>A.14.2 — Security in development</td><td>CI pipeline checks, dependency audit on every PR</td></tr>
  <tr><td>SOC 2</td><td>CC7.1 — Vulnerability management</td><td>Continuous monitoring, defined remediation SLAs</td></tr>
  <tr><td>OWASP</td><td>A06:2021 — Vulnerable components</td><td>Dependabot, npm audit, minimal dependency count</td></tr>
  <tr><td>Australian Privacy Act</td><td>APP 11 — Security of personal information</td><td>Encryption at rest/transit, access controls, audit logging</td></tr>
</table>

<!-- SIGN-OFF -->
<h2>12. Document Control</h2>

<table>
  <tr><th style="width:30%">Item</th><th>Detail</th></tr>
  <tr><td>Document owner</td><td>Compliance Manager</td></tr>
  <tr><td>Effective date</td><td>10 February 2026</td></tr>
  <tr><td>Next review date</td><td>10 May 2026 (quarterly)</td></tr>
  <tr><td>Version</td><td>1.0</td></tr>
  <tr><td>Approved by</td><td><em>[Signature]</em></td></tr>
</table>

<div class="box box-slate" style="margin-top: 32px;">
  <p><strong>Related documents:</strong></p>
  <ul style="margin-bottom:0">
    <li><a href="project-plan.html">Project Implementation Plan</a></li>
    <li><a href="security-compliance-report.html">Security &amp; Compliance Report</a></li>
  </ul>
</div>

</body>
</html>